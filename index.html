<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueForge - Real Upload</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* CSS TIDAK BERUBAH DARI SEBELUMNYA */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        :root { --bg-dark-primary: #0D1117; --bg-dark-secondary: #161B22; --border-color: #30363D; --text-primary: #E6EDF3; --text-secondary: #8B949E; --accent-blue: #2F81F7; --accent-blue-hover: #1F6FEB; --tag-bg: #1A3A69;}
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark-primary); color: var(--text-primary); }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .upload-section { background-color: var(--bg-dark-secondary); padding: 2rem; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 2rem; }
        .upload-section h2 { font-size: 2rem; margin-bottom: 1.5rem; text-align: center; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-secondary); }
        .form-group input, .form-group select { width: 100%; padding: 0.75rem 1rem; background-color: var(--bg-dark-primary); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-size: 1rem; }
        .btn { padding: 0.8rem 1.5rem; border-radius: 6px; font-weight: 600; cursor: pointer; border: none; text-align: center; display: block; width: 100%; }
        .btn-primary { background-color: var(--accent-blue); color: white; }
        #mod-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .mod-card { background-color: var(--bg-dark-secondary); border: 1px solid var(--border-color); border-radius: 8px; display: flex; flex-direction: column; overflow: hidden; }
        .card-thumbnail { width: 100%; height: 160px; object-fit: cover; }
        .card-body { padding: 1rem; flex-grow: 1; }
        .card-title { font-size: 1.25rem; font-weight: 600; }
        .card-author { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem; }
        .card-tags { margin-top: auto; display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; }
        .tag { background-color: var(--tag-bg); color: var(--accent-blue); padding: 0.25rem 0.6rem; border-radius: 4px; font-size: 0.8rem; }
        .card-footer { border-top: 1px solid var(--border-color); padding: 0.75rem 1rem; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; color: var(--text-secondary); }
    </style>
</head>
<body>
    <div class="container">
        <section class="upload-section">
            <h2><i class="fa fa-upload"></i> Upload Your Addon</h2>
            <form id="upload-form">
                <div class="form-group">
                    <label for="addon-title">Addon Title</label>
                    <input type="text" id="addon-title" required>
                </div>
                <div class="form-group">
                    <label for="addon-author">Author Name</label>
                    <input type="text" id="addon-author" required>
                </div>
                <div class="form-group">
                    <label for="addon-category">Category</label>
                    <select id="addon-category" required>
                        <option value="Worlds">Worlds</option>
                        <option value="Mobs">Mobs</option>
                        <option value="Technology">Technology</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="addon-file">Addon File (.mcpack, .zip)</label>
                    <input type="file" id="addon-file" required>
                </div>
                <button type="submit" class="btn btn-primary">Submit Addon</button>
            </form>
        </section>

        <section class="addon-list">
            <h2 style="margin-bottom: 1.5rem;">Uploaded Addons</h2>
            <div id="mod-grid"></div>
        </section>
    </div>

    <script>
        const uploadForm = document.getElementById('upload-form');
        const modGrid = document.getElementById('mod-grid');

        // Fungsi untuk mengambil data dari server dan menampilkannya
        async function fetchAndDisplayAddons() {
            try {
                const response = await fetch('/addons'); // Panggil endpoint GET /addons
                const mods = await response.json();

                modGrid.innerHTML = ''; // Kosongkan grid
                mods.forEach(mod => {
                    const modCard = document.createElement('div');
                    modCard.className = 'mod-card';
                    const tagsHTML = mod.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
                    modCard.innerHTML = `
                        <img src="${mod.image}" alt="${mod.title}" class="card-thumbnail">
                        <div class="card-body">
                            <h3 class="card-title">${mod.title}</h3>
                            <p class="card-author">by ${mod.author}</p>
                            <div class="card-tags">${tagsHTML}</div>
                        </div>
                        <div class="card-footer">
                            <span><i class="fa fa-download"></i> ${mod.downloads}</span>
                            <span>Updated: ${mod.updated}</span>
                        </div>
                    `;
                    modGrid.appendChild(modCard);
                });
            } catch (error) {
                console.error('Error fetching addons:', error);
            }
        }

        uploadForm.addEventListener('submit', async function(event) {
            event.preventDefault();

            // Gunakan FormData untuk mengirim file dan data teks
            const formData = new FormData();
            formData.append('title', document.getElementById('addon-title').value);
            formData.append('author', document.getElementById('addon-author').value);
            formData.append('category', document.getElementById('addon-category').value);
            formData.append('addonFile', document.getElementById('addon-file').files[0]);

            try {
                // Kirim data ke server menggunakan fetch
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData // Tidak perlu header Content-Type, FormData menanganinya
                });

                if (response.ok) {
                    alert('Upload successful!');
                    uploadForm.reset();
                    fetchAndDisplayAddons(); // Refresh daftar addon
                } else {
                    alert('Upload failed. Please try again.');
                }
            } catch (error) {
                console.error('Error uploading file:', error);
                alert('An error occurred during upload.');
            }
        });

        // Tampilkan semua addon saat halaman pertama kali dimuat
        fetchAndDisplayAddons();
    </script>
</body>
</html>
